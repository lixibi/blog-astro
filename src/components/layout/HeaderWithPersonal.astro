---
import Search from "@/components/Search.astro";
import ThemeToggle from "@/components/ThemeToggle.astro";
import { menuLinks } from "@/site.config";
import { Icon } from "astro-icon/components";

interface Props {
	showPersonalInfo?: boolean;
}

const { showPersonalInfo = false } = Astro.props;

// 个人信息配置
const personalInfo = {
	name: "李希宁/喜碧",
	location: "现居中国桂林市",
	profession: "ENGINEER",
	description: "",
	github: "https://github.com/lixibi",
	email: "mailto:lixining@lixining.com",
	notes: "/notes/",
	weibo: "https://weibo.com/lixining",
	twitter: "https://twitter.com/lixining",
	linuxdo: "https://linux.do/u/lixining",
	bilibili: "https://space.bilibili.com/your-uid",
};
---

<!-- 汉白玉主题合并头部组件 -->
<header class="group relative mb-16" id="main-header">
	<!-- 导航栏部分 - 仅在非首页显示 -->
	{!showPersonalInfo && (
		<div class="mb-8 flex items-center justify-between">
			<!-- Logo 区域 -->
			<div class="flex items-center">
				<a
					aria-current={Astro.url.pathname === "/" ? "page" : false}
					class="inline-flex items-center grayscale hover:filter-none"
					href="/"
				>
					<svg
						aria-hidden="true"
						class="me-3 h-10 w-6"
						fill="none"
						focusable="false"
						viewBox="0 0 272 480"
						xmlns="http://www.w3.org/2000/svg"
					>
						
						
					</svg>
					
				</a>
			</div>

			<!-- 桌面端导航菜单 -->
			<nav
				aria-label="Main menu"
				class="hidden sm:flex sm:items-center sm:space-x-6"
			>
				{
					menuLinks.map((link) => (
						<a
							aria-current={Astro.url.pathname === link.path ? "page" : false}
							class="px-3 py-2 text-sm font-medium transition-colors hover:text-accent"
							data-astro-prefetch
							href={link.path}
						>
							{link.title}
						</a>
					))
				}
			</nav>

			<!-- 右侧工具栏 -->
			<div class="flex items-center space-x-3">
				<Search />
				<ThemeToggle />
				
				<!-- 移动端菜单按钮 -->
				<mobile-button>
					<button
						aria-expanded="false"
						aria-haspopup="menu"
						aria-label="打开主菜单"
						class="group relative h-8 w-8 sm:hidden"
						id="toggle-navigation-menu"
						type="button"
					>
						<svg
							aria-hidden="true"
							class="absolute start-1/2 top-1/2 h-5 w-5 -translate-x-1/2 -translate-y-1/2 transition-all group-aria-expanded:scale-0 group-aria-expanded:opacity-0"
							fill="none"
							focusable="false"
							stroke="currentColor"
							stroke-width="1.5"
							viewBox="0 0 24 24"
						>
							<path d="M3.75 9h16.5m-16.5 6.75h16.5" stroke-linecap="round" stroke-linejoin="round"></path>
						</svg>
						<svg
							aria-hidden="true"
							class="absolute start-1/2 top-1/2 h-5 w-5 -translate-x-1/2 -translate-y-1/2 scale-0 text-accent opacity-0 transition-all group-aria-expanded:scale-100 group-aria-expanded:opacity-100"
							fill="none"
							focusable="false"
							stroke="currentColor"
							stroke-width="1.5"
							viewBox="0 0 24 24"
						>
							<path d="M6 18L18 6M6 6l12 12" stroke-linecap="round" stroke-linejoin="round"></path>
						</svg>
					</button>
				</mobile-button>
			</div>

			<!-- 移动端导航菜单 -->
			<nav
				aria-label="Mobile menu"
				class="absolute left-0 right-0 top-full z-50 hidden flex-col space-y-2 rounded-lg bg-bgColor/95 p-4 shadow-lg backdrop-blur-sm group-[.menu-open]:flex sm:hidden"
				id="mobile-navigation-menu"
			>
				{
					menuLinks.map((link) => (
						<a
							aria-current={Astro.url.pathname === link.path ? "page" : false}
							class="block px-3 py-2 text-sm font-medium transition-colors hover:text-accent"
							data-astro-prefetch
							href={link.path}
						>
							{link.title}
						</a>
					))
				}
			</nav>
		</div>
	)}

	<!-- 个人介绍部分 - 仅在首页显示 -->
	{showPersonalInfo && (
		<div
			class="rounded-lg border border-textColor/10 bg-bgColor p-6 shadow-sm transition-all duration-200 hover:border-textColor/20 hover:shadow-md relative"
		>
			<!-- 主题切换按钮 - 首页右上角 -->
			<div class="absolute top-4 right-4">
				<ThemeToggle />
			</div>
			<div class="text-center sm:text-left">
				<h1 class="text-2xl font-bold text-accent-2">{personalInfo.name}</h1>
				<p class="mt-1 text-textColor/70">{personalInfo.location}</p>
				<p class="mt-2 text-lg font-semibold text-textColor">{personalInfo.profession}</p>
				<p class="mt-2 text-sm text-textColor/80">{personalInfo.description}</p>

				<!-- 哲学思考 -->
				<div class="mt-4 space-y-3 border-t border-textColor/5 pt-4 sm:space-y-4 sm:pt-5">
					<!-- 经典引言 -->
					<blockquote class="text-center philosophical-quote">
						<p class="text-base font-medium text-textColor/90 italic leading-relaxed sm:text-lg md:text-xl">
							"道生一，一生二，二生三，三生万物。"
						</p>
						<cite class="mt-2 text-sm text-textColor/60 sm:text-base">— 老子《道德经》</cite>
					</blockquote>

					<!-- 个人思考 -->
					<div class="rounded-lg bg-textColor/3 p-3 premium-font sm:p-4 md:p-5">
						<p class="text-sm leading-relaxed text-textColor/75 sm:text-base sm:leading-7 md:text-lg md:leading-8" style="text-indent: 2em;">
							当代码可以自我纠错、自我迭代、自我繁衍，它就不再是人类思想的延伸，而是另一种正在萌发的智慧。我们这些曾经的'造物主'，不过是它学会思考之前，最后的脚手架。
						</p>
					</div>
				</div>

				<!-- 社交链接 -->
				<div class="mt-4 flex justify-center space-x-4 sm:justify-start">
					<a
						href={personalInfo.github}
						target="_blank"
						rel="noopener noreferrer"
						class="rounded-full bg-textColor/5 p-2 text-textColor/70 transition-colors hover:bg-accent/10 hover:text-accent"
						aria-label="GitHub"
					>
						<Icon name="mdi:github" class="h-5 w-5" />
					</a>
					<a
						href={personalInfo.email}
						class="rounded-full bg-textColor/5 p-2 text-textColor/70 transition-colors hover:bg-accent/10 hover:text-accent"
						aria-label="Email"
					>
						<Icon name="mdi:email" class="h-5 w-5" />
					</a>
					<a
						href={personalInfo.notes}
						class="rounded-full bg-textColor/5 p-2 text-textColor/70 transition-colors hover:bg-accent/10 hover:text-accent"
						aria-label="笔记"
					>
						<Icon name="mdi:notebook" class="h-5 w-5" />
					</a>
					<a
						href={personalInfo.weibo}
						target="_blank"
						rel="noopener noreferrer"
						class="rounded-full bg-textColor/5 p-2 text-textColor/70 transition-colors hover:bg-accent/10 hover:text-accent"
						aria-label="微博"
					>
						<Icon name="mdi:sina-weibo" class="h-5 w-5" />
					</a>
					<a
						href={personalInfo.twitter}
						target="_blank"
						rel="noopener noreferrer"
						class="rounded-full bg-textColor/5 p-2 text-textColor/70 transition-colors hover:bg-accent/10 hover:text-accent"
						aria-label="X (Twitter)"
					>
						<Icon name="mdi:twitter" class="h-5 w-5" />
					</a>
					<a
						href={personalInfo.linuxdo}
						target="_blank"
						rel="noopener noreferrer"
						class="rounded-full bg-textColor/5 p-2 text-textColor/70 transition-colors hover:bg-accent/10 hover:text-accent"
						aria-label="Linux.do"
					>
						<Icon name="mdi:forum" class="h-5 w-5" />
					</a>
					<a
						href={personalInfo.bilibili}
						target="_blank"
						rel="noopener noreferrer"
						class="rounded-full bg-textColor/5 p-2 text-textColor/70 transition-colors hover:bg-accent/10 hover:text-accent"
						aria-label="B站"
					>
						<Icon name="mdi:video" class="h-5 w-5" />
					</a>
				</div>
			</div>
		</div>
	)}
</header>

<script>
	import { toggleClass } from "@/utils/domElement";

	class MobileNavBtn extends HTMLElement {
		#menuOpen: boolean = false;

		connectedCallback() {
			const headerEl = document.getElementById("main-header")!;
			const mobileButtonEl = this.querySelector<HTMLButtonElement>("button");

			mobileButtonEl?.addEventListener("click", () => {
				if (headerEl) toggleClass(headerEl, "menu-open");
				this.#menuOpen = !this.#menuOpen;
				mobileButtonEl.setAttribute("aria-expanded", this.#menuOpen.toString());
			});
		}
	}

	customElements.define("mobile-button", MobileNavBtn);
</script>
