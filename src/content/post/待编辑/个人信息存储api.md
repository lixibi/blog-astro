## 产品需求文档 (PRD): 智能个人信息与备忘数据库

**版本:** 1.1 **日期:** 2025年6月1日

### 1.0 修订历史

|版本|日期|修订人|修订描述|
|---|---|---|---|
|1.0|2025-06-01|AI助手|初始文档创建，基于用户需求描述|
|1.1|2025-06-01|AI助手|根据用户反馈，简化API接口设计描述|

### 2.0 引言

#### 2.1 产品概述

**智能个人信息与备忘数据库**是一款利用大语言模型 (LLM) 进行自然语言处理、FastAPI 构建后端 API、并以 Redis (特别是 RediSearch) 作为高速内存数据库的个人知识管理工具。用户可以通过自然语言输入信息，系统将自动整理并结构化存储。检索时，用户同样可以使用自然语言进行模糊查询，系统通过 LLM 理解意图并结合 RediSearch 的能力返回最相关的结果。数据交互主要通过 MCP (如 Dify 工作流中的网页访问节点) 或类似工具发送 POST 请求完成。

#### 2.2 目标用户

- 需要高效记录和检索零散信息、笔记、联系方式等个人数据的用户。
    
- 偏好使用自然语言进行交互的用户。
    
- 对信息检索有模糊查询和语义理解需求的技术爱好者或高级用户。
    

#### 2.3 产品目标

- **P0 (核心):** 实现基于自然语言的信息录入，自动结构化为 JSON 并存储至 Redis。
    
- **P0 (核心):** 实现基于自然语言的模糊信息检索，能够理解用户意图并从 Redis 中查询相关信息。
    
- **P1:** 提高信息录入的准确性和关键词提取的智能性。
    
- **P1:** 优化检索结果的排序和相关性，LLM 对检索结果进行智能总结。
    
- **P2:** 保证系统的响应速度和数据存储的可靠性。
    

### 3.0 功能需求

#### 3.1 信息录入 (Data Ingestion)

- **FR3.1.1: 自然语言信息接收与处理**
    
    - **描述:** 用户通过 MCP/Dify 等工具，将自然语言描述的信息发送给 LLM 进行初步处理。
        
    - **用户故事:** 我希望输入一段关于“光纤解码器设备的厂家联系方式和相关信息”的文字，系统能帮我理解并准备好存储。
        
    - **LLM 处理流程:**
        
        1. 接收用户输入的文本信息。
            
        2. 根据预设提示词（Prompt: "接收用户信息，并按照相关内容整理好写成JSON格式。包含明确的'title' (标题), 'content' (内容), 和 'keywords' (关键词，由LLM辅助生成，力求精准概括)。准确地整理成JSON格式。"）进行处理。
            
        3. LLM 输出结构化的 JSON 数据。例如：
            
            ```
            {
              "title": "光纤解码器设备厂家联系方式",
              "content": "厂家A，联系人张三，电话138xxxxxxx，邮箱zhangsan@example.com，备注：该公司专注于高端光纤解码器研发。厂家B...",
              "keywords": ["光纤解码器", "厂家", "联系方式", "张三", "高端研发"]
            }
            ```
            
- **FR3.1.2: 数据写入 API**
    
    - **描述:** MCP/Dify 等工具将 LLM 生成的 JSON 数据通过 POST 请求发送到 FastAPI 的指定接口。
        
    - **API 端点:** `POST /api/data/store`
        
    - **请求体 (Request Body):** LLM 生成的包含标题、内容、关键词的 JSON 对象。
        
    - **处理流程:**
        
        1. FastAPI 接收到 POST 请求。
            
        2. 验证请求数据的基本格式。
            
        3. 将 JSON 数据存入 Redis。为了支持 RediSearch，数据需要以特定格式存储，并为 `title`, `content`, `keywords` 字段创建索引。
            
    - **响应 (Response):**
        
        - 成功: 包含成功状态和文档ID的JSON。 (状态码 201 Created)
            
        - 失败: 包含错误信息的JSON。 (状态码 400 Bad Request / 500 Internal Server Error)
            

#### 3.2 信息检索 (Data Retrieval)

- **FR3.2.1: 自然语言检索指令解析**
    
    - **描述:** 用户通过 MCP/Dify 等工具输入自然语言检索指令（例如：“帮我找一下光纤解码器的联系方式”）。
        
    - **用户故事:** 我希望能用“查找光纤解码器的信息”这样的话来搜索我存过的内容。
        
    - **LLM 处理流程:**
        
        1. 接收用户的自然语言检索指令。
            
        2. 根据预设提示词（Prompt: "根据用户的问题：'[用户问题]'，分析其核心意图，并生成用于数据库检索的关键词列表。考虑同义词、近义词和相关概念，以JSON格式输出一个包含'search_terms' (字符串数组)的列表。例如，若用户问'光纤解码器的联系人'，可生成 `{\"search_terms\": [\"光纤解码器\", \"联系人\", \"联系方式\", \"厂家\"]}`"）处理。
            
        3. LLM 输出包含检索关键词的 JSON。例如：
            
            ```
            {
              "search_terms": ["光纤解码器", "联系方式", "厂家"]
            }
            ```
            
- **FR3.2.2: 检索 API 调用**
    
    - **描述:** MCP/Dify 等工具将 LLM 生成的检索关键词 JSON 通过 POST 请求发送到 FastAPI 的检索接口。
        
    - **API 端点:** `POST /api/data/search`
        
    - **请求体 (Request Body):** LLM 生成的包含 `search_terms` 的 JSON 对象。
        
    - **处理流程:**
        
        1. FastAPI 接收到 POST 请求。
            
        2. 从请求体中提取 `search_terms`。
            
        3. 构建 RediSearch 查询语句。利用 `search_terms` 在已索引的 `title`, `content`, `keywords` 字段中进行模糊匹配和多条件查询。
            
        4. 执行 RediSearch 查询。
            
    - **响应 (Response):**
        
        - 成功: 包含成功状态和检索结果数组的JSON。 (状态码 200 OK)
            
        - 未找到: 包含成功状态和空结果数组的JSON。 (状态码 200 OK)
            
        - 失败: 包含错误信息的JSON。 (状态码 400/500)
            
- **FR3.2.3: 检索结果智能提取与呈现**
    
    - **描述:** FastAPI 返回的原始 JSON 结果（可能包含多个匹配项）被发送回 LLM 进行最终处理和总结。
        
    - **用户故事:** 我希望系统能从一堆搜索结果里挑出最相关的内容告诉我，而不是给我看一堆原始数据。
        
    - **LLM 处理流程:**
        
        1. 接收来自 FastAPI 的 JSON 格式的检索结果数组。
            
        2. 根据预设提示词（Prompt: "这是用户的原始问题：'[用户原始检索问题]'。以下是数据库检索到的相关信息列表：'[JSON检索结果数组]'。请仔细阅读这些信息，并根据用户原始问题，提取最核心、最相关的几条信息，并以清晰、简洁的自然语言进行总结回复。"）处理。
            
        3. LLM 输出一段自然语言的总结，直接回答用户的原始检索问题。
            

### 4.0 非功能需求

- **NF4.1: 性能 (Performance)**
    
    - API 响应时间：对于写入和检索请求，P95 响应时间应小于 500ms (不包括 LLM 处理时间)。
        
    - RediSearch 查询性能：对于典型查询，应在 100ms 内返回结果。
        
- **NF4.2: 可用性 (Usability)**
    
    - 用户通过自然语言交互，无需学习复杂查询语法。
        
    - LLM 生成的 JSON 和关键词应尽可能准确，减少用户干预。
        
- **NF4.3: 可靠性 (Reliability)**
    
    - Redis 数据持久化配置，确保数据在服务重启后不丢失。
        
    - FastAPI 应用应具有基本的错误处理和日志记录。
        
- **NF4.4: 可扩展性 (Scalability)**
    
    - FastAPI 应用应设计为无状态，便于水平扩展。
        
    - Redis 可以根据数据量考虑集群方案。
        
- **NF4.5: 安全性 (Security)**
    
    - API 接口可考虑增加认证机制 (如 API Key)。
        
    - 防止恶意输入导致的服务拒绝或数据污染 (通过输入验证和 LLM 的能力)。
        

### 5.0 API 接口设计 (概要)

- **`POST /api/data/store`**
    
    - **描述:** 存储新的信息条目。
        
    - **请求体 (JSON):** 包含待存储信息（如标题、内容、关键词）的JSON对象。
        
    - **成功响应 (201 Created, JSON):** 包含成功状态和新创建条目的唯一标识符。
        
- **`POST /api/data/search`**
    
    - **描述:** 根据关键词检索信息。
        
    - **请求体 (JSON):** 包含用于搜索的关键词列表的JSON对象。
        
    - **成功响应 (200 OK, JSON):** 包含成功状态和匹配的检索结果列表（每个结果包含其详细信息）。
        

### 6.0 LLM 交互设计 (关键提示词示例)

- **信息结构化提示词 (P_STRUCTURE):** `"接收用户信息，并按照相关内容整理好写成JSON格式。包含明确的'title' (标题), 'content' (内容), 和 'keywords' (关键词，由LLM辅助生成，力求精准概括)。准确地整理成JSON格式。用户输入：'{user_raw_input}'"`
    
- **检索意图分析与关键词生成提示词 (P_SEARCH_KEYWORDS):** `"根据用户的问题：'{user_search_query}'，分析其核心意图，并生成用于数据库检索的关键词列表。考虑同义词、近义词和相关概念，以JSON格式输出一个包含'search_terms' (字符串数组)的列表。"`
    
- **检索结果总结提示词 (P_SUMMARIZE_RESULTS):** `"这是用户的原始问题：'{user_search_query}'。以下是数据库检索到的相关信息列表 (JSON格式)：'{search_results_json_array}'。请仔细阅读这些信息，并根据用户原始问题，提取最核心、最相关的几条信息，并以清晰、简洁的自然语言进行总结回复。如果结果为空或不相关，请如实告知。"`
    

### 7.0 技术选型

- **数据库:** Redis (with RediSearch module)
    
- **API 框架:** FastAPI (Python)
    
- **LLM:** 用户选择的任何支持 API 调用的 LLM (如 OpenAI GPT系列, Claude, 或其他)
    
- **API 调用工具:** MCP (如 Dify 工作流中的网页访问节点) 或任何支持发送 HTTP POST 请求的工具 (如 Postman, curl)
    
- **Python Redis 客户端:** `redis-py`
    
- **Python RediSearch 客户端:** `redisearch-py` (或直接通过 `redis-py` 执行 RediSearch 命令)
    

### 8.0 优先级划分

- **Must Have (MVP - 最小可行产品):**
    
    - FR3.1.1 (LLM 结构化核心功能)
        
    - FR3.1.2 (基本数据写入 API 及 Redis 存储)
        
    - FR3.2.1 (LLM 检索关键词生成核心功能)
        
    - FR3.2.2 (基本检索 API 及 RediSearch 查询)
        
    - FR3.2.3 (LLM 对检索结果的基本总结)
        
    - NF4.1 (基本性能保障)
        
    - NF4.3 (基本可靠性)
        
- **Should Have (重要功能):**
    
    - 优化 P_STRUCTURE, P_SEARCH_KEYWORDS, P_SUMMARIZE_RESULTS 提示词以提高准确率。
        
    - RediSearch 索引优化 (权重、排序)。
        
    - API 错误处理和日志记录的完善。
        
- **Could Have (期望功能):**
    
    - 支持信息更新和删除的 API 接口。
        
    - NF4.5 (API 安全认证)。
        
    - 更复杂的 LLM 交互逻辑，例如多轮对话澄清检索意图。
        
- **Won't Have (本次不包含):**
    
    - 独立的用户界面 (GUI)。
        
    - 用户账户管理系统。
        

### 9.0 里程碑计划 (示例)

- **第一阶段 (W1-W2): 环境搭建与核心 API 开发**
    
    - 搭建 Redis (含 RediSearch) 环境。
        
    - 开发 FastAPI `/api/data/store` 和 `/api/data/search` 核心逻辑。
        
    - 完成 Redis 基本数据读写和 RediSearch 索引创建与查询。
        
- **第二阶段 (W3-W4): LLM 集成与初步测试**
    
    - 设计并初步实现 P_STRUCTURE, P_SEARCH_KEYWORDS, P_SUMMARIZE_RESULTS 提示词。
        
    - 通过 MCP/Dify 或 Postman 完成信息录入和检索的端到端流程测试。
        
- **第三阶段 (W5-W6): 优化与迭代**
    
    - 根据测试结果优化 LLM 提示词。
        
    - 优化 RediSearch 查询逻辑和索引配置。
        
    - 完善错误处理和日志。
        
- **第四阶段 (W7): 内部试用与文档完善**
    
    - 小范围内部试用，收集反馈。
        
    - 完善 API 文档和使用说明。
        

### 10.0 风险与挑战

- **LLM 依赖性:** 结果质量高度依赖 LLM 的理解能力和提示词工程的水平。LLM 可能产生幻觉或理解偏差。
    
- **提示词工程复杂度:** 设计高效、鲁棒的提示词需要反复试验和调优。
    
- **RediSearch 配置:** 正确配置 RediSearch 索引以平衡召回率和精确率可能需要经验。
    
- **模糊检索的平衡:** "模糊"的程度难以精确控制，可能返回过多不相关结果或漏掉相关结果。LLM 的总结能力是关键。
    
- **成本:** LLM API 调用可能会产生费用，尤其是在高频使用场景下。
    
- **数据隐私:** 由于数据会经过 LLM 处理，需关注数据隐私和安全问题，明确告知用户。